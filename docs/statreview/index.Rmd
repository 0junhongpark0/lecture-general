---
title: "Reviewer들을 위한 의학통계"
author: 김진섭
institute: "차라투(주)"
date: "2022-4-8"
output:
  xaringan::moon_reader:
    css: ["css/footer-header.css", "default"]
    lib_dir: libs
    nature:
      beforeInit: "js/macros.js"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "4:3" 
subtitle: "제18차 대한이식학회 춘계학술대회 심포지엄"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
library(knitr);library(DT);library(shiny);library(survival);library(survsim)
data.t <- data.frame(sex = sample(c("Male", "Female"), 30, replace = T), tChol = round(rnorm(30, mean = 150, sd = 30)))
data.fisher <- data.frame(HTN_medi = round(rbinom(50, 1, 0.2)), DM_medi = round(rbinom(50, 1, 0.2)))
```

layout: true

<div class="my-footer"><span><a href="https://www.zarathu.com">Zarathu Co.,Ltd</a>   
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="https://github.com/jinseob2kim">김진섭</a></span></div> 



---

# Executive summary

**Table 1**
- 연속변수 2그룹: 정규분포 **t-test**, 아니면 **Wilcox-test**
- 연속변수 3그룹이상: 정규분포 **ANOVA**, 아니면 **Kruskal–Wallis ANOVA**
- 범주형 변수: 샘플수 충분하면 **Chisq-test**, 아니면 **Fisher-test**


**회귀분석**
- **Univariate, multivariate** 같이 보여주기, **Subgroup** 분석 추천
- **Stepwise selection 비추천**: 예측모형 목적 아님, 임상맥락 고려X


**생존분석**
- Kaplan-meier 그림선 겹치면 안됨: **Time stratification** 필요 
- 보정할 변수가 Index time 이후면 안됨: **Time-dependent covariate** 필요
- Propensity score 매칭 후 pair 고려한 **stratified cox 는 필수아님**


**국민건강영양조사**
- **표본추출정보를 고려**한 통계분석: Survey table1/GLM/Cox


---

class: center, middle


# 소개 


---
# 맞춤형 통계웹

![](https://jinseob2kim.github.io/lecture-general/korea-preventive/ss.png)
---
# [공개 통계웹](http://app.zarathu.com) 

![](https://blog.zarathu.com/posts/2018-11-24-basic-biostatistics/app.gif)


---
# 주요 계약 


- 대한심혈관중재학회 [COBIS III 레지스트리](https://clinicaltrials.gov/ct2/show/NCT03068494) 분석: [추가계약](http://pf.kakao.com/_XsuxgC/48388190)


- 서울성모병원 [COREA-AMI II 레지스트리](https://clinicaltrials.gov/ct2/show/NCT02806102) 분석: [10개 연구 계약](http://pf.kakao.com/_XsuxgC/48043955)


- 삼성서울병원 [공통데이터모델(CDM)](http://www.feedernet.org/html/?pmode=cdmdrn) 분석: [심평원 코로나데이터](https://hira-covid19.net/) 분석 중 


- 강동성심병원 CDM 분석지원: 공단표본데이터 분석 중 


- 경기도감염병관리지원단 코로나 대시보드 with Shinykorea: [최종보고](https://shinykorea.github.io/corona-activityrecord) 


- 삼성서울병원 이식외과 육종(sarcoma) 데이터 분석: [5개 연구 계약](http://pf.kakao.com/_XsuxgC/51701089) 


- 해운대백병원 정신질환 네트워크분석: [논문 5편](http://pf.kakao.com/_XsuxgC/52664370) 게재


- 성균관의대 환경역학연구실 [미세먼지 대시보드](http://pf.kakao.com/_XsuxgC/43627405)


- [삼성서울병원 정신과, 응급의학과, 임상역학센터 통계자문계약](http://pf.kakao.com/_XsuxgC/55192190)

- [서울대병원 순환기내과 통계자문계약](http://pf.kakao.com/_XsuxgC/55577702)



---
# 주요 논문 성과 

.large[
SCI 논문 200건 지원
]
<center>
<img src="https://jinseob2kim.github.io/lecture-general/cdmkdh/paper.jpg" width=80%></a>
</center>



---
class: center, middle

# 의학통계 Tip

---
# 연구의 흐름?

.large[
- **Table 1**으로 데이터를 보여주고

- **단변량(univariate)** 분석으로 가설검정

- **다변량(multivariate)** or 소그룹(subgroup) 분석: 다른 변수들의 효과를 보정.
]

---
# Table 1: 연속변수
.large[
- 연속변수 2그룹: 정규분포 **t-test**, 아니면 **Wilcox-test**

- 연속변수 3그룹이상: 정규분포 **ANOVA**, 아니면 **Kruskal–Wallis ANOVA**
]

--
.large[
**등분산 가정 필요없음!!**
]
- 등분산 가정이란 두 그룹의 분산이 같다고 가정하는 것인데, 계산이 좀 더 쉽다는 이점이 있으나 아무 근거 없이 분산이 같다고 가정하는 것은 위험한 가정이다.


---
# 등분산가정 

.small[
```{r, echo=T}
t.test(tChol ~ sex, data = data.t, var.equal = T)
t.test(tChol ~ sex, data = data.t, var.equal = F)
```
]


---
# Table 1: 범주형변수
.large[
- 범주별 N수만 고려: 기본 **Chisq**, 부족하면 **Fisher-test**
]

```{r, echo=T}
table(data.fisher)
chisq.test(table(data.fisher))
```


---
# 회귀분석

.large[
**단변량, 다변량 같이** 보여주면 좋음
]

<center>
<img src="https://www.researchgate.net/profile/Anne-Dyrhol-Riise/publication/259766024/figure/tbl4/AS:392649367408643@1470626312604/Univariate-and-multivariate-analysis-of-factors-associated-with-a-positive-TST-5-mm.png" width=80%></a>
</center>

---
# Stepwise selection

.large[
- 다변량 포함 기준은 **임상적 중요성 or 단변량 유의성**

- Stepwise selection은 임상적 중요성도 무시, 통계학적 논리도 부족
]


---
# Subgroup analysis

.large[
**다변량분석보다 더 좋은 증거**
]
- 예) 성별 보정 < 성별에 따른 subgroup 분석

.large[
**Interaction 포함한 forest plot** 추천
]


<center>
<img src="https://www.researchgate.net/publication/332229730/figure/fig2/AS:744331304521728@1554473820106/Subgroup-analyses-of-the-primary-outcome-The-forest-plot-shows-that-the-difference-in.ppm
" width=60%></a>
</center>



---
# 생존분석: 비례위험가정

.large[
트렌드 일정하다는 가정: **생존곡선 겹치면 안됨**
]
- 비례위험가정 test까진 필요없음: 그림으로 확인

<center>
<img src="https://i.stack.imgur.com/TzLk8.png" width=80%></a>
</center>


---
# Landmark-analysis

.large[
시간 나눠 따로 분석]
<center>
<img src="https://blog.zarathu.com/posts/2020-10-29-survivalpractice/survivalpractice_files/figure-html5/unnamed-chunk-6-1.png" width=80%></a>
</center>

---
# Time-dependent cox

```{r}
vet2 <- survSplit(Surv(time, status) ~ ., data = veteran, cut=c(90, 180), episode = "tgroup", id = "id")
rmarkdown::paged_table(vet2)

```
---
# Time-dependet cox

```{r}
vfit2 <- coxph(Surv(tstart, time, status) ~ trt + prior + karno:strata(tgroup), data=vet2)
summary(vfit2)

```


---
# Time-dependent covariate

.large[
생존분석 **모든 변수는 Index date 이전에 측정**해야
]
- 예) F/U lab, medication
.large[
Time-dependent covariate 다루려면 이를 고려한 cox 필요
]

```{r}
N=100 #number of patients
set.seed(123)
df.tf<-simple.surv.sim(#baseline time fixed
 n=N, foltime=500,
 dist.ev=c('llogistic'),
 anc.ev=c(0.68), beta0.ev=c(5.8),
 anc.cens=1.2,
 beta0.cens=7.4,
 z=list(c("unif", 0.8, 1.2)),
 beta=list(c(-0.4),c(0)),
 x=list(c("bern", 0.5),
 c("normal", 70, 13)))
for (v in 4:7){
  df.tf[[v]] <- round(df.tf[[v]])
}
names(df.tf)[c(1,4,6,7)]<-c("id", "time", "grp","age")
df.tf <- df.tf[, -3]
 nft<-sample(1:10,
 N,replace=T)#number of follow up time points
crp<-round(abs(rnorm(sum(nft)+N,
 mean=100,sd=40)),1)
time<-NA
id<-NA
i=0
for(n in nft){
i=i+1
time.n<-sample(1:500,n)
time.n<-c(0,sort(time.n))
time<-c(time,time.n)
id.n<-rep(i,n+1)
id<-c(id,id.n)
}
df.td <- cbind(data.frame(id,time)[-1,],crp)


df <- tmerge(df.tf, df.tf, id = id, status1 = event(time, status))
df2 <- tmerge(df, df.td, id = id, crp = tdc(time, crp))
rmarkdown::paged_table(df2)
```

---
# PS matching: Stratified cox

.large[
Propensity score 매칭 후 **stratified cox 필수 아님**
]

- Stratified: 매칭쌍끼리는 **baseline hazard**가 같고, **다른 쌍끼린 다르다**는 가정.

- No stratified: baseline hazard **전부 동일**하다는 가정

.large[
1:1 매칭이면 $\dfrac{N}{2}$ 개나 strata가 생김. 의미 없음

1:다 매칭으로 strata갯수가 적으면 고려할 수도?
]


---
# 국민건강영양조사

**2-stage cluster sampling**
- **psu(1차집락)**: 서울전체 랜덤 200명(X), 서울 특정 지역 골라서 200명(O)
- **kstrata(2차집락)**: 지역과 집의 형태 (아파트/일반주택) 
- **wt(가중치)**: 인원이 적은데 사회적으로 혹은 학문적으로 배려해야 할 경우 대상자를 조금 많이 모집한 후 가중치를 줄여서 반영, 영양/설문/임상 검사에 따라 가중치종류 다름름 

**SAS** surveyreg surveylogistic, **R** svyglm svycox

<center>
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FxpFlG%2FbtqAyxBZnBG%2FnSjUohAQ00nKktNcEqwEq0%2Fimg.png" width=50%></a>
</center>





---

# Executive summary

**Table 1**
- 연속변수 2그룹: 정규분포 **t-test**, 아니면 **Wilcox-test**
- 연속변수 3그룹이상: 정규분포 **ANOVA**, 아니면 **Kruskal–Wallis ANOVA**
- 범주형 변수: 샘플수 충분하면 **Chisq-test**, 아니면 **Fisher-test**


**회귀분석**
- **Univariate, multivariate** 같이 보여주기, **Subgroup** 분석 추천
- **Stepwise selection 비추천**: 예측모형 목적 아님, 임상맥락 고려X


**생존분석**
- Kaplan-meier 그림선 겹치면 안됨: **Time stratification** 필요 
- 보정할 변수가 Index time 이후면 안됨: **Time-dependent covariate** 필요
- Propensity score 매칭 후 pair 고려한 **stratified cox 는 필수아님**


**국민건강영양조사**
- **표본추출정보를 고려**한 통계분석: Survey table1/GLM/Cox


---
class: center, middle

# END
